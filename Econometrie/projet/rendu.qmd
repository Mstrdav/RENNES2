---
title: "La source du bonheur" 
format:
  html:
    other-links:
      - text: Colin
        href: https://colin.geind.re/
      - text: Denis
        href: https://dataforgood.fr/
    css: style.css
    toc: true
    toc_depth: 3
    toc_float: true
    collapsed: true
    smooth_scroll: true
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = TRUE) #Activer le cache des chunks pour accélérer les recompilations
options("install.lock"=FALSE) #Désactiver le verrouillage d’installation des packages
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
library(pastecs)
library(stargazer)
library(psych)
library(ggplot2)
library(car)
library(lmtest)
library(sandwich)
library(corrplot)
library(olsrr) #graohique des résidus
library(gridExtra)

```

```{r}

# Enlever les commentaires
# étoffer le plan
# numéroter les graphiques et tableaux
# labeliser les axes
# pas de code R dans le rendu final html juste les graphiques et les commentaires
# stat desc : décrire les résultats : interpréter ou analyser
# selectionner les graphiques pertinents et ne pas tout montrer
# un document de référence
# Ne pas utiliser le code de la variable dans l interprétation

# spécifier nos sélections de variables si ce n'est déjà fait

```

**JAOUEN Denis - GEINDRE Colin**

[**Master 1 MAS - Université de Rennes**](https://eco.univ-rennes.fr/master-mathematiques-appliquees-statistique) et [**Master 1 MAS - Université Rennes 2**](https://formations.univ-rennes2.fr/fr/formations/master-37/master-mention-mathematiques-appliquees-statistique-parcours-sciences-des-donnees-intelligence-artificielle-JFTJBMKM.html)

La rédaction de ce document s'appuie sur l'utilisation d'IA générative, ainsi que sur des blocs de codes fournit sur des forums comme medium ou stack overflow. Les auteur.ice.s de ces blocs sont remercié.e.s en fin de document.

# Introduction

Sommes-nous heureux ? L'étions-nous plus auparavant ? Quels modèles de société sont les plus heureux ? Et surtout, quelle est la recette du bonheur ? Questions difficiles, mais qui revêtent une importance capitale pour chacun d'entre nous, notamment dans la recherche économique et sociale actuelle.

Le terme de "Bonheur National Brut" (ou en anglais "Gross National Happiness") est apparu pour la première fois au Bhutan, à la fin des années 1970. Jigme Singye Wangchuck, alors roi du pays, déclare "Gross National Happiness is more important than Gross Domestic Product", une phrase qui a influencé le développement de pays, engageant les politiques nationales et locales autour d'une approche holistique de la notion de progrès, moins centrée sur les marqueurs socio-économiques classiques.

Le GNHI, indice de bonheur national développé par le Bhutan, est maintenant utilisé dans de nombreux pays autours du monde. Il est construit sur un ensemble de marqueurs répartis dans 9 pôles considérés comme égaux.

En effet, depuis trop longtemps, l'indice de développement d'un pays a été calculé sur des indices économiques : PIB, croissance, taux d'emploi, etc. Ce choix n'est pas neutre, il sert un système particulier qui ne met pas l'humain ou l'environnement au coeur de ses priorités. Cependant, de plus en plus de sociologues et d'économistes préconisent d'ajouter à ces mesures des marqueurs de bien-être sociétal. Mais comment mesurer le bonheur ? Existe-t-il des bases de données sérieuses et fiables permettant de répondre à nos questions ?

Si le [GNHI](https://ophi.org.uk/gross-national-happiness) permet un classement selon un index de bonheur, il est déjà construit sur un postulat, celui que le bonheur est expliqué par un ensemble de facteurs socio économiques définis. Si on veut démontrer ce postulat, on ne peut pas prendre le GNHI comme index de bonheur. Nous avons préféré étudier les résultats du World Happiness Report - de [Gallup](https://www.gallup.com/analytics/318875/global-research.aspx), étude annuelle construite sur un questionnaire utilisant des échelles de Cantril (la principale étant "Imaginez une échelle à 10 échelons, l'échelon 0 étant la pire vie que vous pourriez imaginer, le 10 la meilleure. Sur quel échelon êtes-vous actuellement ?"). D'autres études utilisent des échelles similaires, les échelles de Likert. On citera notamment l'Integrated Values Surveys, qui est celle avec la plus longue échelle de temps, mais que nous avons rejeté car le nombre de pays est plus restreint, et la formulation des questions a changé plusieurs fois. Les postulats sont alors plus simples, et on se mettra simplement d'accord sur le fait que :

-   La distance mentale entre les différentes réponses au questionnaire est stable, c'est à dire que nous pouvons faire des mathématiques dessus (calculer des moyennes, etc.). On assume une échelle **cardinale** et pas simplement **ordinale**.

-   Le bonheur est autodéterminé de manière précise. Nous assumons que l'erreur d'auto évaluation de son bonheur personel est une variable aléatoire qui suit une distribution normale. Ainsi, il n'y a pas de biais qui, par exemple, pousserait les personnes malheureuses à s'estimer plus heureuses qu'elles ne le sont.

Ces hypothèses sont cohérentes avec la littérature scientifique, mais restent fortement débattues. En particulier, l'utilisation d'échelle cardinale plutôt qu'ordinale ne change que très peu les résultats des régression, comme l'ont démontré plusieurs économistes (Ferris, 2002). Celle-ci est de plus intuitive, et grandement facilitante pour nos calculs. Par contre, il existe un effet plafond/plancher : il est plus difficile de passer de 9 à 10 que de 5 à 6 ; l'échelle n'est probablement pas cardinale dans les extrèmes. Nous faisons là une approximation consciente. La deuxième hypothèse, elle, est corroborée par la loi des grand nombre (les données de Gallup sont les plus fournies au monde), et par les différentes études sur les marqueurs de bonheur (taux de suicide, expressions faciales...), qui tendent à démontrer que les sujets ne mentent pas sur leur bonheur. Mais certaines cultures valorisent (latino-américaines) ou dévalorisent (Japon, Corée) socialement de se dire heureux, ce qui peut tirer les résultats vers le haut ou vers le bas. De plus, le tapis roulant hédonique, ou l'adaptation à ses conditions, ainsi que la désirabilité sociale qui pousse les répondants à paraître normaux aux yeux des enquêteurs, peuvent créer une homogénisation des résultats.

Pour contrer ces biais, on introduit parfois des effets fixes "pays", comme les membres de l'OCDE, les pays Latino-américains, etc.

Un dernier problème que nous voulons aborder est celui de la barrière de la langue. Est-ce que tout le monde à la même perception du "bonheur", ou est-ce que les mots, le langage utilisé pour définir cette notion change au point que la langue influence les réponses ? Mais de nombreuses études ont montré que l'on arrivait relativement bien à apprécier le bonheur des autres, quelque soit notre pays d'origine et celui de l'autre, impliquant que le bonheur revêt une définition globale relativement comprise partout (voir Sandvil, 1993 et Diner & Lucas, 1999).

Nous nous attendons à voir une corrélation entre l'indice de bonheur du WHR, et différents indicateurs socio-économiques. De plus, nous nous attendons a voir les biais culturels sus-cités.

# Plan

-   Introduction
-   Cadre méthodologique
    -   Modèle de régression et correction
-   Analyse des données
    -   Cadre des données
    -   Pré-traitement des données
        -   Données manquantes
        -   Suppression des doublons
        -   Recherche des outliers
        -   Transformation des données
    -   Analyses descriptives univariées
        -   Variables explicatives
        -   Variable cible
    -   Analyses descriptives multivariées
        -   Corrélations entre variables
        -   Analyse des interactions
-   Résultats et discussion
    -   Modélisation principale
    -   Robustesse des résultats
    -   Analyses complémentaires
-   Conclusion
-   Bibliographie

# Cadre méthodologique

Le cadre méthodologique général est celui de la régression linéaire, avec une estimation des moindres carrés ordinaires. En fonction des données, des corrections éventuelles (white, MCG, etc.) pourront être envisagées. Pour chaque partie, une méthodologie plus précise sera discutée.

## Modèle de régression et corrections

Voici la formulation mathématique du modèle linéaire estimé par moindres carrés ordinaires (MCO) :

-   Modèle en notation matricielle : $y = X\beta + \varepsilon,\quad \mathbb{E}[\varepsilon|X]=0$

-   Estimation MCO : $\hat\beta{MCO} = \operatorname*{arg\,min}\beta \sum{\varepsilon_i^2} = (X'X)^{-1}X'y$

-   Sous homoscédasticité $(\operatorname{Var}(\varepsilon)=\sigma^2 I)$ *:* $\operatorname{Var}(\hat\beta{MCO}) = \sigma^2 (X'X)^{-1}$

-   En présence d'hétéroscédasticité, la variance générale s'écrit avec la matrice diagonale $Ω$, $(Var(ε)=Ω)$ : $\operatorname{Var}(\hat\beta{MCO}) = (X'X)^{-1} X' \Omega X (X'X)^{-1}$

-   Exemples de transformations de variables et modèles correspondants (interprétations rapides) :

    -   Modèle linéaire en niveaux : $y_i = \alpha + \beta x_i + u_i$. Effet absolu de x sur y.
    -   Log‑niveau (log(x) explicative) : $y_i = \alpha + \beta \log(x_i) + u_i$. β = variation absolue de y pour une variation proportionnelle de x (approx. effet semi‑élasticité).
    -   Log‑log (log(y) vs log(x)) : $\log(y_i) = \alpha + \beta \log(x_i) + u_i ]$. β = élasticité (pourcentage de y lorsque x varie de 1%).
    -   Quadratique / polynôme : $y_i = \alpha + \beta_1 x_i + \beta_2 x_i^2 + u_i$. Permet capturer non‑linéarités (effets en U, concavité).
    -   Effet interactif : $y_i = \alpha + \beta_1 x_i + \beta_2 D_i + \beta_3 (x_i \times D_i) + u_i$. Effet de x différent selon la modalité D. On étudie les effets croisés de la même façon.

# **Analyse des données**

## Cadre des données

Nous avons tenté d'avoir le cadre le plus global possible. Ainsi nous étudions les pays du monde entier, en particulier les 147 référencés par le world happiness report. Après sélection de nos variables, il nous reste 125 pays à étudier.

Ayant des données allant de 1789 à 2024 et beaucoup de données manquantes, nous avons choisi de traiter les moyennes des données disponibles de 2013 à 2023. Certains jeux de données s'achèvent avant 2023, nous avons donc fait leurs moyennes jusqu'à la dernière année recensée. Cette décision a été motivée par notre envie de tirer des conclusions les plus larges possibles.

| Code de la série | Définition | Unité | Source |
|:---|----|:--:|---:|
| Code | Le code du pays | Caractères | \- |
| Political_Corruption | La moyenne de 2013 à 2023 d'un index de corruption politique allant de 0 à 1 | Index allant de 0 à 1 | [World Bank](https://data360.worldbank.org/en/indicator/) |
| GDP_per_capita | La moyenne de 2013 à 2023 du PIB par habitant | En dollar américain par habitant | [World Bank](https://data360.worldbank.org/en/indicator/WB_WDI_NY_GDP_PCAP_CD) |
| Lifespan | La moyenne de 2013 à 202O de l'espérance de vie à la naissance | En années | [World Bank](https://data360.worldbank.org/en/indicator/WB_ESG_SP_DYN_LE00_IN) |
| Net_Migration | La moyenne de 2013 à 2020 de la migration nette | En nombre de personnes | [World Bank](https://data360.worldbank.org/en/indicator/WB_WDI_SM_POP_NETM) |
| Overweight_Adults | La moyenne de 2013 à 2016 de la proportion d'adulte de 18 ans et plus dont l'IMC est supérieur à 25. | En pourcentage | [World Bank](https://data360.worldbank.org/en/indicator/WB_HNP_SH_STA_OWAD_ZS) |
| Population_density | La moyenne de 2013 à 2021 de la densité de population en nombre d'habitant à la mi-année par kilomètres carrés | En habitant par kilomètre carré | [World Bank](https://data360.worldbank.org/en/indicator/WB_WDI_EN_POP_DNST) |
| KWH_pp_pc | La moyenne de 2013 à 2023 de la consommation en kilowattheure par personne | En kilowattheure par personne | [World Bank](https://ourworldindata.org/grapher/per-capita-energy-use?overlay=download-data) |
| Military_Expenses | La moyenne de 2013 à 2023 du pourcentage du PIB dédié à la dépense militaire | En pourcentage du PIB | [Our World in Data](https://ourworldindata.org/grapher/military-spending-as-a-share-of-gdp-sipri?overlay=download-data) |
| Population_Growth | La moyenne de 2013 à 2023 de la croissance en pourcentage de la population | En pourcentage | [Our World in Data](https://ourworldindata.org/grapher/population-growth-rates?tab=map&overlay=download-data) |
| Primary_School_Enrollment | La moyenne de 2013 à 2022 du nombre d'étudiant inscrits en école primaire divisé par la population du groupe d'age multiplié par 100 | En pourcentage | [World Bank](https://data360.worldbank.org/en/indicator/WB_ESG_SE_PRM_ENRR) |
| OCDE | Une indicatrice avec 1 si le pays est membre de l'OCDE et 0 sinon | Indicatrice | [OCDE](https://www.oecd.org/en/about/members-partners.html) |
| Happiness | La moyenne de 2013 à 2023 de l'indice du bonheur calculé par le World Happiness Index | Index allant de 0 à 10 | [World Happiness Report](https://www.worldhappiness.report/data-sharing/) |

## Prétraitement et nettoyage des données

Pour éviter un maximum de données manquantes, nous avons effectuer des moyennes depuis 2013 et jusqu'à un maximum de 2023 sur toutes les données étudiées. Cela nous permet aussi d'atténuer les tendances qui ont pu se passer dans des temps plus courts sur cette décennie.

Nous avons sélectionné les jeux de données que nous avons trouvé nous paraissant les plus intéressant. Certains ont du être écartés du jeu de donnée final dû à un manque de donnée. En effet plusieurs pays n'étaient pas recensés dans les données et notre système de moyenne ne pouvait les ramener dans le jeu de donnée.

## Analyse descriptive univariée des données

```{r echo=FALSE}
# import des données
data = read.csv(file = 'donnees.csv', row.names = 2)[,-1] # pour enlever la colonne "numero"
head(data)
#transform OCDE variable into factor
data$OCDE <- as.factor(data$OCDE)
```

```{r echo=FALSE}
# Etude des statistiques descriptives
data_numeric <- data[, sapply(data, is.numeric)]
stargazer(data_numeric, median = TRUE, type = "text", title="Statistiques descriptives ", digits=2)
```

On voit tout de suite, par comparaison de la moyenne et de la médiane de chaque variable certaines tendances : le PIB par habitant contient des individus qui tirent la moyenne vers le haut, idem pour la migration, le KWH par habitant et la densité de population.

En étudiant les minimums, maximums, étendues et écarts-type de ces quatre variables, on remarque qu'il ne s'agit probablement que de quelques individus dont les valeurs très fortes déforment les moyennes. Par exemple, la densité de population a une étendue de 7812, une médiane de 80 et un écart -type de seulement 65. On s'attend à observer dans ces variables des petits groupes d'individus aux valeurs très élevées.

Un effet inverse et de moindre importance peut aussi être constaté quand au surpoids des adultes. On voit que la moyenne est légèrement tirée vers le bas.

Les dépenses militaires ayant une moyenne légèrement plus élevée que la médiane et un écart-type faible malgré un maximum assez élevé, on s'attend à observer très peu d'individus avec des valeurs très élevées mais une concentration importante des individus autour de la médiane.

Le reste des variables ont l'air d'être peu dispersées. On peut s'atttendre à y voir une répartition normale des valeurs.

```{r echo=FALSE}
# histogramme de la variable cible
ggplot(data, aes(x=Happiness)) +
  geom_histogram(binwidth=0.25, fill="blue", color="black", alpha=0.7) +
  labs(title="Histogramme du score de bonheur", x="Score de bonheur", y="Fréquence")   + theme_minimal()

# boxplot de la variable cible
ggplot(data, aes(y=Happiness)) +
  geom_boxplot(fill="orange", color="black", alpha=0.7) +
  labs(title="Boxplot du score de bonheur", y="Score de bonheur") +
  theme_minimal()
```

A première vue, l'histogramme nous indique que l'indice du bonheur semble difficilement suivre une loi normale. On repère cela à une certaine symétrie et une concentration d'indivus autour du centre, particulièrement deux pics : l'un proche de 4,5 et le second de 6.

Le boxplot du bonheur présente une répartition très équilibrée de notre variable explicative. On n'y repère pas de tendances particulières si ce n'est que les deux quarts les moins heureux sont légèrement plus grands.

### Analyse de chaque variable explicative

```{r echo=FALSE, fig.height=12, fig.width=12}
plots <- list()

for (i in 1:ncol(data_numeric)) {
  p <- ggplot(data_numeric, aes_string(x=data_numeric[[i]])) +
    geom_histogram(binwidth=diff(range(data_numeric[[i]]))/30, fill="green", color="black", alpha=0.7) +
    labs(x=colnames(data_numeric)[i], y="") +
    theme_minimal() +
    theme(plot.margin = grid::unit(c(0.5,0.5,0.5,0.5), "cm"))
  plots[[i]] <- p
}
plots = plots[-11]
# nombre de colonnes voulu
ncol_plot <- 2
#do.call(grid.arrange, c(plots, ncol = ncol_plot))
```

```{r echo=FALSE}
do.call(grid.arrange, c(plots[c(4,8,9,10)], ncol = 2))
```

Au vu de la symétrie de leurs histogrammes on peut considérer que la croissance de la population, l'inscription à l'école primaire, les dépenses militaires et la migration peuvent suivre des lois normales.

```{r echo=FALSE}
do.call(grid.arrange, c(plots[c(2,6,7)], ncol = 2))
```

La consommation d'énergie, la densité de population et le PIB par habitant semblent suivre des lois inverses.

```{r echo=FALSE}
do.call(grid.arrange, c(plots[c(1,3,5)], ncol = 2))
```

La corruption politique, le surpoids et l'espérance de vie ne semblent pas suivre des lois classiques.

On remarque immédiatement les individus les plus aberrants qui referont surface dans les graphiques suivants et dont nous parlerons plus tard:

-   On repère dans l'histogramme de l'inscription à l'école primaire un individu atypique proche de 0, il s'agit de la Somalie avec moins de 9% d'inscrits.

-   De la même manière dans l'histogramme de la densité de population, on repère Singapour avec une densité titanesque de près de 8000 habitants au km2.

-   Dans l'histogramme de la migration, le Pakistan apparait tout à gauche avec plus d'1,5 million de migration nettte négative et les Etats-Unis tout à droite avec plus d'1,2 million de migration nette positive.

-   Le Luxembourg est l'individu tout à droite de l'histogramme du PIB par habitant.

-   Et le Qatar est l'individu tout à droite dans l'histogramme de la consommation énergétique.

## Analyse descriptive bivariée des données

```{r echo=FALSE, fig.height=4, fig.width=6}
# Corrélations simples et affichage graphique (base R)
vars <- names(data_numeric)[-ncol(data_numeric)]
cors <- sapply(vars, function(v) cor(data_numeric$Happiness, data_numeric[[v]]))
# trier par valeur (pour barplot horizontal)
cors_sorted <- sort(cors)
par(mar = c(5, 8, 4, 2))
barplot(cors_sorted, horiz = TRUE, las = 1,
  # gradient color from cor
  col = viridis::viridis(length(cors_sorted), alpha = 0.8)[rank(cors_sorted)],
  xlab = "Corrélation avec happiness_moyenne",
  main = "Corrélations des variables explicatives")
abline(v = 0, lty = 2, col = "grey40")
par(mar = c(5, 4, 4, 2) + 0.1)
```

On remarque ici les variables les plus et les moins corrélées à l'indice du bonheur. L'espérance de vie, le PIB/hab, le surpoids et la consommation énergétique sont très corrélées positivement avec l'indice de bonheur tandis que la corruption politique et la croissance de population semblent elles être corrélées négativement.\
Les autres variables ne semblent pas être corrélées fortement à l'indice de bonheur.

```{r echo=FALSE, fig.height=12, fig.width=12}
# Tracé des graphes de points et de la linéarité
scatter_plots <- list()

for (i in 2:11) {
  p <- ggplot(data, aes_string(x=data[[i]], y="Happiness")) +
    geom_point() +
    geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    labs(x=colnames(data)[i], y="Happiness") +
    theme_minimal()
  scatter_plots[[i-1]] <- p
}

# nombre de colonnes voulu
ncol_plot <- 3
do.call(grid.arrange, c(scatter_plots, ncol = ncol_plot))

```

A nouveau, on retrouve les individus aberrants repérés plus tôt qui déforment complètement les graphiques sur l'inscription à l'école primaire, la densité de population et la migration nette. Il serait bon de voir la répartition de ces graphes sans ces individus.

Dans le graphe du surpoids par l'indice de bonheur, on repère comme dans l'histogramme du surpoids deux pics de surreprésentation.

La entre l'indice de bonheur et le PIB/hab semble logarithmique avec une concentation forte des individus vers les valeurs les plus faibles. De même pour le graphe de la consommation énergétique.

On doute de la linéarité entre l'indice de bonheur et la corruption politique car le nuage de point est très dispersé. De même pour la croissance de la population et les dépenses militaires.

Finalement, on remarque une certaine linéarité positive entre l'indice de bonheur et l'espérance de vie à la naissance, les points semblent bien décrire une droite.

```{r}


data_ss_singapour = data[-which(data$Code == "SGP"),]
sspopplot = ggplot(data_ss_singapour, aes_string(x="Population_Density", y="Happiness")) +
    geom_point() +
    geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    labs(x="Densité de population sans Singapour", y="Happiness") +
    theme_minimal()


data_ss_somalie = data[-which(data$Code == "SOM"),]
ssschoolplot= ggplot(data_ss_somalie, aes_string(x="Primary_School_Enrollment", y="Happiness")) +
    geom_point() +
    geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    labs(x="Inscriptions à l'école primaire sans la Somalie", y="Happiness") +
    theme_minimal()

data_ss_pak_usa = data[-which(data$Code == "PAK" |data$Code == "USA" ),]
ssmigrationplot = ggplot(data_ss_pak_usa, aes_string(x="Net_Migration", y="Happiness")) +
    geom_point() +
    geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    labs(x="Migration sans les EU ni le Pakistan", y="Happiness") +
    theme_minimal()


outlierplots = list(sspopplot,ssschoolplot, ssmigrationplot)


do.call(grid.arrange, c(outlierplots, ncol = 2))
```

Ici, retirer les individus les plus aberrants ne permet pas pour autant d'obtenir une linéarité de la relation entre l'indice de bonheur et les variables étudiées.

```{r}


data_PIB_log = data
data_PIB_log$GDP_per_Capita = log(data_PIB_log$GDP_per_Capita)
PIBplot = ggplot(data_PIB_log, aes_string(x="GDP_per_Capita", y="Happiness")) +
    geom_point() +
    geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    labs(x="Logarithme du PIB par habitant", y="Happiness") +
    theme_minimal()


data_KWH_log = data
data_KWH_log$KWH_pp_pc  = log(data_KWH_log$KWH_pp_pc)
KWHplot = ggplot(data_KWH_log, aes_string(x="KWH_pp_pc", y="Happiness")) +
    geom_point() +
    geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    labs(x="Logarithme de la consommmation énergétique", y="Happiness") +
    theme_minimal()


data_migration = data
data_migration$Net_Migration  = log(data_migration$Net_Migration)
migrationplot = ggplot(data_migration, aes_string(x="Net_Migration", y="Happiness")) +
    geom_point() +
    geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
    labs(x="Logarithme de la migration", y="Happiness") +
    theme_minimal()

logplots = list(PIBplot,KWHplot,migrationplot)


do.call(grid.arrange, c(logplots, ncol = 2))
```

Appliquer un logarithme au PIB par habitant et à la consommation énergétique permet un lien linéaire très clair avec l'indice de bonheur. La relation est moins forte mais c'est aussi le cas avec la migration nette, sans même retirer les individus aberrants qui sont bien projetés sur la droite.

Aucune modification classique (exp, log, carré) ne donne une meilleure linéarité aux autres variables (j'ai tout testé).

```{r echo=FALSE, fig.height=12, fig.width=12}
# Tracé des graphes de points et de la linéarité
box_plots <- list()

for (i in 2:11) {
  p <- ggplot(data, aes_string(x="Happiness", y=data[[i]])) +
    geom_boxplot(notch=FALSE, outlier.colour="red", outlier.shape=8,
                outlier.size=4) +
    labs(x="Happiness", y=colnames(data)[i]) + 
    theme_minimal()
  box_plots[[i-1]] <- p
}

# nombre de colonnes voulu
ncol_plot <- 3
do.call(grid.arrange, c(box_plots, ncol = ncol_plot))

```

```{r}
ggplot(data, aes(x = OCDE,y=Happiness)) +
  geom_boxplot(fill="orange", color="black", alpha=0.7) +
  labs(title="Boxplot du bonheur en fonction de l'appartenance à l'OCDE", y="Score de bonheur") +
  theme_minimal()
```

Il est clair que les pays membres de l'OCDE ont un bonheur bien plus élevé que les non-membres.

# **Analyse et discussion des résultats**

## Modélisation principale

```{r echo=FALSE}
# premier modèle : toutes les variables candidates
reg1 <- lm(Happiness ~ Political_Corruption + KWH_pp_pc + GDP_per_Capita + Lifespan + Net_Migration + Overweight_Adults + Population_Density + Military_Expenses + Population_Growth + OCDE + Primary_School_Enrollment, data = data)

cat('\n--- Résumé du modèle (reg1) ---\n')
print(summary(reg1))
```

De prime abord, on constate d'après le test de Fisher, que notre modèle explique plus de 80% de la variance de l'indice de bonheur. Nos variables significatives, par ordre de significativité, sont l'espérance de vie, le surpoids, le PIB par habitant, la dépense militaire, la participation à l'OCDE et l'inscription à l'école primaire.

Présentation et interprétation des résultats obtenus : utiliser un tableau récapitulatif des modèles principaux testés

TESTER DES MODELES DIFFERENTS

COMPARAISON VISU\
TEST D'ANOVA ENTRE CES MODELES

EN BACKWARD, trifouiller avec les AIC

## Robustesse des résultats

```{r echo=FALSE}
# Corrélation entre les variables explicatives
corrplot(cor(data_numeric[,-ncol(data_numeric)]), method="shade", type = "lower", tl.col="black", tl.srt=25)
```

On voit que certaines variables sont corrélées, source de problème pour notre régression à venir bien qu'aucune ne passe le seuil critique de 0,8. En voici les plus importantes :

-   La corruption politique est corrélée négativement avec le PIB/hab à -0,72.

-   Le PIB/hab a une correlation positive à 0,72 avec la consommation énergétique et à 0,67 avec l'espérance de vie.

-   L'espérance de vie est corrélée positivement avec le surpoids à 0,72.

On a donc quatre variables qui semblent corrélées entre elles. Utilisons l'indice du VIF pour s'assurer du problème :

```{r echo=FALSE}
# VIF pour contrôler la multicolinéarité

stargazer(vif(reg1)[1:5], median = TRUE, type = "text", title="VIF", digits=2)
stargazer(vif(reg1)[6:9], median = TRUE, type = "text", digits=2)
stargazer(vif(reg1)[10:11], median = TRUE, type = "text", digits=2)

```

Le VIF, indice de multicolinéarité, est supérieur à 4 pour la consommation énergétique, le PIB par habitant et l'espérance de vie. On considère 4 comme seuil critique et on admet un problème de multicolinéarité à résoudre prochainement.

```{r echo=FALSE}
# Test d'hétéroscédasticité (Breusch-Pagan) et coefficients robustes HC1

print('Test de Breusch-Pagan :')
print(bptest(reg1))

print('Coefficients avec erreurs robustes (HC1) :')
print(lmtest::coeftest(reg1, vcov. = sandwich::vcovHC(reg1, type = 'HC1')))


```

Avec une p-value aussi haute au test de Breusch-Pagan, on choisit de ne pas rejeter l'hypothèse nulle : on considère bien que les résidus sont homoscédastiques, c'est à dire que la variance est constante.

Je ne sais pas comment lire le test HC1 de lmtest

```{r echo=FALSE}

ols_plot_resid_hist(reg1) #j'arrive pas à rajouter un titre
#Residual vs fitted
plot(reg1, which = 1, main = "Résidus par rapport aux valeurs ajustées")
#normal QQplot
plot(reg1, which=2, main = "Résidus standardisés par rapport aux quantiles théoriques") #SI NORMALITE DES RESIDUS : ILS SERAIENT SUR LA LIGNNE


```

Le premier graphique nous montre que les résidus semblent suivre grossièrement une loi normale et on ne repère pas de forme spécifique dans le graphe des résidus par rapport aux valeurs ajustées.

Cependant, les résidus ne sont pas disposés sur la droite définie par les quantiles théoriques. Pour s'assurer de leur normalité, on va procédé à un test de normalité.

```{r echo=FALSE}
print('Test de Shapiro-Wilk :')
shapiro.test(reg1$residuals)
```

La p-value du test étant de 0,3309, on conserve l'hypothèse nulle stipulant que les résidus suivent une loi normale.

On a donc bien ici des résidus homoscédastiques et normaux lmais une certaine multicolinéarité de nos variables explicatives. Dans la section suivante, on va donc essayer de perfectionner le modèle en commençant par résoudre ces problèmes de multicolinéarité.

## Analyses complémentaires

```{r}
#on met en log les variables linéarisées par log
reglog <- lm(Happiness ~ Political_Corruption + log(KWH_pp_pc) + log(GDP_per_Capita) + Lifespan + log(Net_Migration) + Overweight_Adults + Population_Density + Military_Expenses + Population_Growth + OCDE + Primary_School_Enrollment, data = data)

summary(reglog)


```

-   Transformation de variables / effets non linéaires LOG / CARRE / EFFETS CROISES

-   Changement structurel

-   Effets croisés de variables

# **Conclusion générale et perspectives**

Rappel de la problématique et de la méthodologie

Synthèse des résultats principaux

Contributions du mémoire, apports scientifiques et/ou applicatifs

Perspectives d’amélioration ou de recherche future

possible sources d'erreur : mauvaises mesures des données, simultanéité, variables omises

# Bibliographie - Source des données
