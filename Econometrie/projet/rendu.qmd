---
title: "La source du bonheur" 
format:
  html:
    other-links:
      - text: Colin
        href: https://colin.geind.re/
      - text: Denis
        href: https://dataforgood.fr/
    css: style.css
    toc: true
    toc_depth: 3
    toc_float: true
    collapsed: true
    smooth_scroll: true
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = TRUE) # Activer le cache des chunks pour accélérer les recompilations
options("install.lock" = FALSE) # Désactiver le verrouillage d’installation des packages
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
library(pastecs)
library(stargazer)
library(psych)
library(ggplot2)
library(car)
library(lmtest)
library(sandwich)
library(corrplot)
library(olsrr) # graohique des résidus
library(gridExtra)

```

```{r}

# Enlever les commentaires
# étoffer le plan
# numéroter les graphiques et tableaux
# labeliser les axes
# pas de code R dans le rendu final html juste les graphiques et les commentaires
# stat desc : décrire les résultats : interpréter ou analyser
# selectionner les graphiques pertinents et ne pas tout montrer
# un document de référence
# Ne pas utiliser le code de la variable dans l interprétation

# spécifier nos sélections de variables si ce n'est déjà fait

```

**JAOUEN Denis - GEINDRE Colin**

[**Master 1 MAS - Université de Rennes**](https://eco.univ-rennes.fr/master-mathematiques-appliquees-statistique) et [**Master 1 MAS - Université Rennes 2**](https://formations.univ-rennes2.fr/fr/formations/master-37/master-mention-mathematiques-appliquees-statistique-parcours-sciences-des-donnees-intelligence-artificielle-JFTJBMKM.html)

La rédaction de ce document s'appuie sur l'utilisation d'IA générative, ainsi que sur des blocs de codes fournit sur des forums comme medium ou stack overflow. Les auteur.ice.s de ces blocs sont remercié.e.s en fin de document.

# Introduction

Sommes-nous heureux ? L'étions-nous plus auparavant ? Quels modèles de société sont les plus heureux ? Et surtout, quelle est la recette du bonheur ? Questions difficiles, mais qui revêtent une importance capitale pour chacun d'entre nous, notamment dans la recherche économique et sociale actuelle.

Le terme de **"Bonheur National Brut"** (ou en anglais "Gross National Happiness") est apparu pour la première fois au Bhutan, à la fin des années 1970. Jigme Singye Wangchuck, alors roi du pays, déclare "Gross National Happiness is more important than Gross Domestic Product", une phrase qui a influencé le développement de pays, engageant les politiques nationales et locales autour d'une approche holistique de la notion de progrès, moins centrée sur les marqueurs socio-économiques classiques.

Le **GNHI**, indice de bonheur national développé par le Bhutan, est maintenant utilisé dans de nombreux pays autours du monde. Il est construit sur un ensemble de marqueurs répartis dans 9 pôles considérés comme égaux.

En effet, depuis trop longtemps, l'indice de développement d'un pays a été calculé sur des indices économiques : **PIB**, croissance, taux d'emploi, etc. Ce choix n'est pas neutre, il sert un système particulier qui ne met pas l'humain ou l'environnement au coeur de ses priorités. Cependant, de plus en plus de sociologues et d'économistes préconisent d'ajouter à ces mesures des marqueurs de bien-être sociétal. Mais comment mesurer le bonheur ? Existe-t-il des bases de données sérieuses et fiables permettant de répondre à nos questions ?

Si le [GNHI](https://ophi.org.uk/gross-national-happiness) permet un classement selon un index de bonheur, il est déjà construit sur un postulat, celui que le bonheur est expliqué par un ensemble de facteurs socio-économiques définis. Si on veut démontrer ce postulat, on ne peut pas prendre le GNHI comme index de bonheur. Nous avons préféré étudier les résultats du **World Happiness Report** - de [Gallup](https://www.gallup.com/analytics/318875/global-research.aspx), étude annuelle construite sur un questionnaire utilisant des échelles de Cantril (la principale étant "Imaginez une échelle à 10 échelons, l'échelon 0 étant la pire vie que vous pourriez imaginer, le 10 la meilleure. Sur quel échelon êtes-vous actuellement ?"). D'autres études utilisent des échelles similaires, les échelles de Likert. On citera notamment l'Integrated Values Surveys, qui est celle avec la plus longue échelle de temps, mais que nous avons rejeté car le nombre de pays est plus restreint, et la formulation des questions a changé plusieurs fois. Les postulats sont alors plus simples, et on se mettra simplement d'accord sur le fait que :

-   La distance mentale entre les différentes réponses au questionnaire est stable, c'est à dire que nous pouvons faire des mathématiques dessus (calculer des moyennes, etc.). Nous supposons une échelle **cardinale** et pas simplement **ordinale**.

-   Le bonheur est autodéterminé de manière précise. Nous supposons que l'erreur d'auto-évaluation de son bonheur personnel est une variable aléatoire qui suit une distribution normale. Ainsi, il n'y a pas de biais qui, par exemple, pousserait les personnes malheureuses à s'estimer plus heureuses qu'elles ne le sont.

Ces hypothèses sont cohérentes avec la littérature scientifique, mais restent fortement débattues. En particulier, l'utilisation d'échelle cardinale plutôt qu'ordinale ne change que très peu les résultats des régressions, comme l'ont démontré plusieurs économistes (Ferris, 2002). Celle-ci est de plus intuitive, et grandement facilitante pour nos calculs. Par contre, il existe un effet plafond/plancher : il est plus difficile de passer de 9 à 10 que de 5 à 6 ; l'échelle n'est probablement pas cardinale dans les extrêmes. Nous faisons là une approximation consciente. La deuxième hypothèse, elle, est corroborée par la loi des **grands nombres** (les données de Gallup sont les plus fournies au monde), et par les différentes études sur les marqueurs de bonheur (taux de suicide, expressions faciales...), qui tendent à démontrer que les sujets ne mentent pas sur leur bonheur. Mais certaines cultures valorisent (latino-américaines) ou dévalorisent (Japon, Corée) socialement de se dire heureux, ce qui peut tirer les résultats vers le haut ou vers le bas. De plus, le tapis roulant hédonique, ou l'adaptation à ses conditions, ainsi que la désirabilité sociale qui pousse les répondants à paraître normaux aux yeux des enquêteurs, peuvent créer une homogénisation des résultats.

Pour contrer ces biais, on introduit parfois des **effets fixes "pays"**, comme les membres de l'OCDE, les pays Latino-américains, etc.

Un dernier problème que nous voulons aborder est celui de la barrière de la langue. Est-ce que tout le monde à la même perception du "bonheur", ou est-ce que les mots, le langage utilisé pour définir cette notion change au point que la langue influence les réponses ? Mais de nombreuses études ont montré que l'on arrivait relativement bien à apprécier le bonheur des autres, quelque soit notre pays d'origine et celui de l'autre, impliquant que le bonheur revêt une définition globale relativement comprise partout (voir Sandvil, 1993 et Diner & Lucas, 1999).

Nous nous attendons à voir une **corrélation** entre l'indice de bonheur du WHR, et différents indicateurs socio-économiques. De plus, nous nous attendons a voir les biais culturels sus-cités.

# Plan

-   Introduction
-   Cadre méthodologique
    -   Modèle de régression
    -   Corrections et transformations de variables
-   Analyse des données
    -   Cadre des données
    -   Pré-traitement des données
        -   Données manquantes
        -   Suppression des doublons
        -   Recherche des outliers
        -   Transformation des données
    -   Analyses descriptives univariées
        -   Variables explicatives
        -   Variable cible
    -   Analyses descriptives multivariées
        -   Corrélations entre variables
        -   Analyse des interactions
-   Résultats et discussion
    -   Modélisation principale
    -   Modélisation avancée et sélection de variables
    -   Diagnostics des résidus sur le modèle final
    -   Analyse des points influents
    -   Conclusion sur les corrections
-   Conclusion
-   Bibliographie

# Cadre méthodologique

Le cadre méthodologique général est celui de la régression linéaire, avec une estimation des moindres carrés ordinaires. En fonction des données, des corrections éventuelles (white, MCG, etc.) pourront être envisagées. Pour chaque partie, une méthodologie plus précise sera discutée.

## Modèle de régression

Voici la formulation mathématique du modèle linéaire estimé par moindres carrés ordinaires (MCO), en notation matricielle. $$
y = X\beta + \varepsilon
$$

Dans notre cas, le modèle est formulé ainsi :

$$
\begin{align}
  Happiness &= \beta_0\\
  &+ \beta_1 Political\_Corruption + \beta_2 GDP\_per\_capita + \beta_3 Lifespan\\
  &+ \beta_4 Net\_Migration + \beta_5 Overweight\_Adults + \beta_6 Population\_density \\
  &+ \beta_7 KWH\_pp\_pc + \beta_8 Military\_Expenses + \beta_9 Population\_Growth \\
  &+ \beta_{10} Primary\_School\_Enrollment + \beta_{11} OCDE\\
  &+ \varepsilon
\end{align}
$$

On estime alors les paramètres via la méthode des moindres carrés ordinaires : $$
\hat{\beta}_{MCO} = \operatorname*{arg\,min}\beta \sum{\varepsilon_i^2} = (X'X)^{-1}X'y
$$

Cette méthode assume certaines hypothèses :

-   **Linéarité** : la relation entre les variables explicatives et la variable cible est linéaire (et la variable cible est continue).

-   **Exogénéité** : les variables explicatives ne sont pas corrélées avec le terme d'erreur, $E(X'\varepsilon) = 0$.

-   **Homoscédasticité** : la variance des erreurs est constante, $\operatorname{Var}(\varepsilon) = \sigma^2 I$.

-   **Normalité** : les résidus sont distribuées normalement, $\varepsilon \sim \mathcal{N}(0, \sigma^2)$.

-   **Absence d’autocorrélation des variables explicatives** : les variables explicatives ne sont pas corrélées entre elles.

-   **Absence d’autocorrélation des résidus**, $\operatorname{Cov}(\varepsilon_i, \varepsilon_j) = 0$ pour $i \neq j$.

Sous homoscédasticité : $\operatorname{Var}(\hat{\beta}_{MCO}) = \sigma^2 (X'X)^{-1}$

En présence d'hétéroscédasticité, la variance générale s'écrit avec la matrice diagonale $\Omega$, $(Var(\varepsilon)=\Omega)$ : $\operatorname{Var}(\hat{\beta}_{MCO}) = (X'X)^{-1} X' \Omega X (X'X)^{-1}$

## Corrections et transformations de variables

Exemples de transformations de variables et modèles correspondants (interprétations rapides) :

-   Modèle linéaire en niveaux : $y_i = \alpha + \beta x_i + u_i$. Effet absolu de x sur y.
-   Log‑niveau (log(x) explicative) : $y_i = \alpha + \beta \log(x_i) + u_i$. β = variation absolue de y pour une variation proportionnelle de x (approx. effet semi‑élasticité).
-   Log‑log (log(y) vs log(x)) : $\log(y_i) = \alpha + \beta \log(x_i) + u_i ]$. β = élasticité (pourcentage de y lorsque x varie de 1%).
-   Quadratique / polynôme : $y_i = \alpha + \beta_1 x_i + \beta_2 x_i^2 + u_i$. Permet capturer non‑linéarités (effets en U, concavité).
-   Effet interactif : $y_i = \alpha + \beta_1 x_i + \beta_2 D_i + \beta_3 (x_i \times D_i) + u_i$. Effet de x différent selon la modalité D. On étudie les effets croisés de la même façon.

# Analyse des données

## Cadre des données

Nous avons tenté d'avoir le cadre le plus global possible. Ainsi nous étudions les pays du monde entier, en particulier les 147 référencés par le world happiness report. Après sélection de nos variables, il nous reste 125 pays à étudier.

Ayant des données allant de 1789 à 2024 et beaucoup de données manquantes, nous avons choisi de traiter les moyennes des données disponibles de 2013 à 2023. Certains jeux de données s'achèvent avant 2023, nous avons donc fait leurs moyennes jusqu'à la dernière année recensée. Cette décision a été motivée par notre envie de tirer des conclusions les plus larges possibles.

| Code de la série | Définition | Unité | Source |
|:-----------------|------------------|:----------------:|-----------------:|
| Code | Le code du pays | Caractères | \- |
| S | La moyenne de 2013 à 2023 d'un index de corruption politique allant de 0 à 1 | Index allant de 0 à 1 | [World Bank](https://data360.worldbank.org/en/indicator/) |
| GDP_per_capita | La moyenne de 2013 à 2023 du PIB par habitant | En dollar américain par habitant | [World Bank](https://data360.worldbank.org/en/indicator/WB_WDI_NY_GDP_PCAP_CD) |
| Lifespan | La moyenne de 2013 à 202O de l'espérance de vie à la naissance | En années | [World Bank](https://data360.worldbank.org/en/indicator/WB_ESG_SP_DYN_LE00_IN) |
| Net_Migration | La moyenne de 2013 à 2020 de la migration nette | En nombre de personnes | [World Bank](https://data360.worldbank.org/en/indicator/WB_WDI_SM_POP_NETM) |
| Overweight_Adults | La moyenne de 2013 à 2016 de la proportion d'adulte de 18 ans et plus dont l'IMC est supérieur à 25. | En pourcentage | [World Bank](https://data360.worldbank.org/en/indicator/WB_HNP_SH_STA_OWAD_ZS) |
| Population_density | La moyenne de 2013 à 2021 de la densité de population en nombre d'habitant à la mi-année par kilomètres carrés | En habitant par kilomètre carré | [World Bank](https://data360.worldbank.org/en/indicator/WB_WDI_EN_POP_DNST) |
| KWH_pp_pc | La moyenne de 2013 à 2023 de la consommation en kilowattheure par personne | En kilowattheure par personne | [World Bank](https://ourworldindata.org/grapher/per-capita-energy-use?overlay=download-data) |
| Military_Expenses | La moyenne de 2013 à 2023 du pourcentage du PIB dédié à la dépense militaire | En pourcentage du PIB | [Our World in Data](https://ourworldindata.org/grapher/military-spending-as-a-share-of-gdp-sipri?overlay=download-data) |
| Population_Growth | La moyenne de 2013 à 2023 de la croissance en pourcentage de la population | En pourcentage | [Our World in Data](https://ourworldindata.org/grapher/population-growth-rates?tab=map&overlay=download-data) |
| Primary_School_Enrollment | La moyenne de 2013 à 2022 du nombre d'étudiant inscrits en école primaire divisé par la population du groupe d'age multiplié par 100 | En pourcentage | [World Bank](https://data360.worldbank.org/en/indicator/WB_ESG_SE_PRM_ENRR) |
| OCDE | Une indicatrice avec 1 si le pays est membre de l'OCDE et 0 sinon | Indicatrice | [OCDE](https://www.oecd.org/en/about/members-partners.html) |
| Happiness | La moyenne de 2013 à 2023 de l'indice du bonheur calculé par le World Happiness Index | Index allant de 0 à 10 | [World Happiness Report](https://www.worldhappiness.report/data-sharing/) |

## Prétraitement et nettoyage des données

Pour éviter un maximum de données manquantes, nous avons effectué des **moyennes** depuis 2013 et jusqu'à un maximum de 2023 sur toutes les données étudiées. Cela nous permet aussi d'atténuer les tendances qui ont pu se passer dans des temps plus courts sur cette décennie.

Nous avons sélectionné les jeux de données que nous avons trouvé nous paraissant les plus intéressant. Certains ont du être écartés du jeu de donnée final dû à un manque de donnée. En effet plusieurs pays n'étaient pas recensés dans les données et notre système de moyenne ne pouvait les ramener dans le jeu de donnée.

## Analyse descriptive univariée des données

```{r echo=FALSE}
# import des données
data <- read.csv(file = "donnees.csv", row.names = 2)[, -1] # pour enlever la colonne "numero"
# transform OCDE variable into factor
data$OCDE <- as.factor(data$OCDE)
```

```{r echo=FALSE}
# Etude des statistiques descriptives
data_numeric <- data[, sapply(data, is.numeric)]
stargazer(data_numeric,
    type = "text", title = "Statistiques descriptives", digits = 2,
    summary.stat = c("mean", "sd", "min", "median", "max")
)

```

On voit tout de suite, par comparaison de la moyenne et de la médiane de chaque variable certaines tendances : le PIB par habitant contient des individus qui tirent la moyenne vers le haut, idem pour la migration, le KWH par habitant et la densité de population.

En étudiant les minimums, maximums, étendues et écarts-type de ces quatre variables, on remarque qu'il ne s'agit probablement que de quelques individus dont les valeurs très fortes déforment les moyennes. Par exemple, la densité de population a une étendue de 7812, une médiane de 80 et un écart -type de seulement 65. On s'attend à observer dans ces variables des **petits groupes d'individus** aux valeurs très élevées.

Un effet inverse et de moindre importance peut aussi être constaté quand au surpoids des adultes. On voit que la moyenne est légèrement tirée vers le bas.

Les dépenses militaires ayant une moyenne légèrement plus élevée que la médiane et un écart-type faible malgré un maximum assez élevé, on s'attend à observer très peu d'individus avec des valeurs très élevées mais une concentration importante des individus autour de la médiane.

Le reste des variables ont l'air d'être peu dispersées. On peut s'atttendre à y voir une répartition normale des valeurs.

::: {#fig1 .fig}
```{r echo=FALSE}
# histogramme de la variable cible
ggplot(data, aes(x = Happiness)) +
    geom_histogram(binwidth = 0.25, fill = "salmon1", color = "black", alpha = 0.7) +
    labs(title = "Histogramme du score de bonheur", x = "Score de bonheur", y = "Fréquence") +
    theme_minimal()
```

Figure 1 : Histogramme du score de bonheur
:::

::: {#fig2 .fig}
```{r echo=FALSE}
# boxplot de la variable cible
ggplot(data, aes(y = Happiness)) +
    geom_boxplot(fill = "salmon1", color = "black", alpha = 0.7) +
    labs(title = "Boxplot du score de bonheur", y = "Score de bonheur") +
    theme_minimal()
```

Figure 2 : Boxplot du score de bonheur
:::

A première vue, la fig.1 semble difficilement suivre une loi normale. On repère cela à une certaine symétrie et une concentration d'indivus autour du centre, particulièrement deux pics : l'un proche de 4,5 et le second de 6.

La fig.2 présente une répartition très équilibrée de notre variable explicative. On n'y repère pas de tendances particulières si ce n'est que les deux quarts les moins heureux sont légèrement plus grands.

### Analyse de chaque variable explicative

```{r echo=FALSE, fig.height=12, fig.width=12}
plots <- list()

nomsdevar = c("Corruption politique", "PIB par habitant", "Espérance de vie", "Migration nette", "Surpoids", "Densité de population", "Consommation énergétique", "Dépenses militaires", "Croissance de population", "Inscriptions à l'école primaire")


for (i in 1:ncol(data_numeric)) {
    p <- ggplot(data_numeric, aes_string(x = data_numeric[[i]])) +
        geom_histogram(binwidth = diff(range(data_numeric[[i]])) / 30, fill = "salmon1", color = "black", alpha = 0.7) +
        labs(x = nomsdevar[i], y = "") +
        theme_minimal() +
        theme(plot.margin = grid::unit(c(0.5, 0.5, 0.5, 0.5), "cm"))
    plots[[i]] <- p
}
plots <- plots[-11]

```

::: {#fig3 .fig}
```{r echo=FALSE}
do.call(grid.arrange, c(plots[c(4, 8, 9, 10)], ncol = 2))
```

Figure 3 : Histogrammes sélectionnés (Population growth, Primary school enrollment, Military expenses, Net migration)
:::

Au vu de la symétrie de leurs histogrammes on peut considérer que la croissance de la population, l'inscription à l'école primaire, les dépenses militaires et la migration peuvent suivre des lois normales.

::: {#fig4 .fig}
```{r echo=FALSE}
do.call(grid.arrange, c(plots[c(2, 6, 7)], ncol = 2))
```

Figure 4 : Histogrammes sélectionnés (GDP per capita, Population density, KWH per capita)
:::

La consommation d'énergie, la densité de population et le PIB par habitant semblent suivre des lois inverses.

::: {#fig5 .fig}
```{r echo=FALSE}
do.call(grid.arrange, c(plots[c(1, 3, 5)], ncol = 2))
```

Figure 5 : Histogrammes sélectionnés (Political corruption, Lifespan at birth, Overweight adults)
:::

La corruption politique, le surpoids et l'espérance de vie ne semblent pas suivre des lois classiques.

On remarque immédiatement les individus les plus aberrants qui referont surface dans les graphiques suivants et dont nous parlerons plus tard:

-   On repère dans l'histogramme de l'inscription à l'école primaire un individu atypique proche de 0, il s'agit de la **Somalie** avec moins de 9% d'inscrits.

-   De la même manière dans l'histogramme de la densité de population, on repère **Singapour** avec une densité titanesque de près de 8000 habitants au km2.

-   Dans l'histogramme de la migration, le **Pakistan** apparait tout à gauche avec plus d'1,5 million de migration nettte négative et les **Etats-Unis** tout à droite avec plus d'1,2 million de migration nette positive.

-   Le **Luxembourg** est l'individu tout à droite de l'histogramme du PIB par habitant.

-   Et le **Qatar** est l'individu tout à droite dans l'histogramme de la consommation énergétique.

## Analyse descriptive bivariée des données

```{r echo=FALSE}
# Corrélations simples et affichage graphique (base R)
vars <- names(data_numeric)[-ncol(data_numeric)]
cors <- sapply(vars, function(v) cor(data_numeric$Happiness, data_numeric[[v]]))
# trier par valeur (pour barplot horizontal)
names(cors) = nomsdevar
cors_sorted <- sort(cors)
```

::: {#fig6 .fig}
```{r echo=FALSE, fig.height=5, fig.width=6}

par(mar = c(5, 8, 4, 2))
barplot(cors_sorted,
    horiz = TRUE, las = 1,
    # bicolor
    col = ifelse(cors_sorted > 0, "lightblue", "salmon1"),
    main = "Corrélations avec l'indice de bonheur",
)
abline(v = 0, lty = 2, col = "grey40")
par(mar = c(5, 4, 4, 2) + 0.1)


```

Figure 6 : Corrélations des variables explicatives avec l'indice de bonheur
:::

On remarque ici les variables les plus et les moins corrélées à l'indice du bonheur. L'espérance de vie, le PIB/hab, le surpoids et la consommation énergétique sont très corrélées positivement avec l'indice de bonheur tandis que la corruption politique et la croissance de population semblent elles être corrélées négativement.\
Les autres variables sont peu ou très peu corrélées à l'indice de bonheur.

On va voir par la suite que ces correlations se traduisent en relations linéaires avec des droites décroissantes pour les variables corrélées négativement et inversement. On verra aussi que les variables avec les plus petites corrélations ont les coefficients directeurs les plus faibles et inversement.

```{r echo=FAlSE}
scatter_plots <- list()


for (i in 2:11) {
    p <- ggplot(data, aes_string(x = data[[i]], y = "Happiness")) +
        geom_point() +
        geom_smooth(method = lm, color = "salmon1", fill = "lightblue", se = TRUE) +
        labs(x = nomsdevar[i-1], y = "Happiness") +
        theme_minimal()
    scatter_plots[[i - 1]] <- p
}

```

::: {#fig7 .fig}
```{r echo=FALSE, fig.height=6, fig.width=8}
# Tracé des graphes de points et de la linéarité


do.call(grid.arrange, c(scatter_plots[c(3)], ncol = 1))
```

Figure 7 : Nuage de points entre l'espérance de vie et l'indice de bonheur
:::

Premièrement, on remarque une bonne linéarité positive entre l'indice de bonheur et l'espérance de vie à la naissance, les points semblent bien décrire une droite. C'est notre variable la plus corrélée à l'indice de bonheur et la mieux représentée linéairement.

```{r echo=FALSE}
do.call(grid.arrange, c(scatter_plots[c(1,5,9,8)], ncol = 2))
```

Figure 8 : Nuages de points assez dispersés

Ensuite, nous avons trois variables qui ont une relation linéaire avec l'indice de bonheur mais dont les nuages de points sont très dispersés : la corruption politique, la croissance de population et le surpoids.

On remarque dans le nuage de point de la corruption politique un ensemble d'individus très proches, des pays heureux et peu corrompus qui ensemble ont un effet important sur la droite de linéarité et qui lui donne son aspect décroissant.

On remarque également les deux concentration d'individus dans le graphe du surpoids, comme on pouvait l'apercevoir dans l'histogramme du surpoids (fig. 5).

Notre quatrième graphe représente les dépenses militaires : la variable la moins corrélée à l'indice de bonheur (fig. 6). Sans surprise, on ne voit pas de linéarité avec l'indice de bonheur, la droite est horizontale et le nuage de point est très dispersé bien qu'on aperçoive les quelques individus dont le budget alloué aux dépenses militaires est plus élevé.

```{r echo=FALSE}

data_ss_singapour <- data[-which(data$Code == "SGP"), ]
sspopplot <- ggplot(data_ss_singapour, aes_string(x = "Population_Density", y = "Happiness")) +
    geom_point(color = "blue") +
    geom_smooth(method = lm, color = "salmon1", fill = "lightblue", se = TRUE) +
    labs(x = "Sans Singapour", y = "Happiness") +
    theme_minimal()


data_ss_somalie <- data[-which(data$Code == "SOM"), ]
ssschoolplot <- ggplot(data_ss_somalie, aes_string(x = "Primary_School_Enrollment", y = "Happiness")) +
    geom_point(color = "blue") +
    geom_smooth(method = lm, color = "salmon1", fill = "lightblue", se = TRUE) +
    labs(x = "Sans la Somalie", y = "Happiness") +
    theme_minimal()

data_ss_pak_usa <- data[-which(data$Code == "PAK" | data$Code == "USA"), ]
ssmigrationplot <- ggplot(data_ss_pak_usa, aes_string(x = "Net_Migration", y = "Happiness")) +
    geom_point(color = "blue") +
    geom_smooth(method = lm, color = "salmon1", fill = "lightblue", se = TRUE) +
    labs(x = "Sans les EU ni le Pakistan", y = "Happiness") +
    theme_minimal()

outlierplots <- list(ssmigrationplot, sspopplot, ssschoolplot)

```

```{r echo=FALSE, fig.height=6, fig.width=8}

do.call(grid.arrange, c(c(scatter_plots[c(4,6,10)],outlierplots), ncol = 3))
```

Figure 9 : Nuage de points les plus concentrés

Voyons maintenant les variables qui dont les individus sont très concentrés, mettant en évidence certains individus aberrants repérés plus tôt (figure 3 et 4) : les EU et le Pakistan pour la migration, Singapour pour la densité de population et la Somalie pour le taux d'inscription à l'école primaire.

Cela dit, ces individus ne sont pas mal projetés vis-à-vis des droites de relation linéaire avec l'indice de bonheur. Ils ne semblent pas avoir d'effet particulièrement grand sur leurs droites respectives.

Afin d'observer les nuages de points concentrés de plus près, nous avons retiré les individus aberrants susnommés. Comme on peut le voir, cela ne permet pas d'obtenir une linéarité claire de la relation entre l'indice de bonheur et les variables étudiées. Tout comme les dépenses militaires, ces variables ne semblent pas ou peu corrélées à notre score de bonheur et leur forte concentration d'individus complique toute étude visuelle du lien avec le bonheur.

```{r echo=FALSE}
data_PIB_log <- data
data_PIB_log$GDP_per_Capita <- log(data_PIB_log$GDP_per_Capita)
PIBplot <- ggplot(data_PIB_log, aes_string(x = "GDP_per_Capita", y = "Happiness")) +
    geom_point(color = "blue") +
    geom_smooth(method = lm, color = "salmon1", fill = "lightblue", se = TRUE) +
    labs(x = "Logarithme du PIB par habitant", y = "Happiness") +
    theme_minimal()


data_KWH_log <- data
data_KWH_log$KWH_pp_pc <- log(data_KWH_log$KWH_pp_pc)
KWHplot <- ggplot(data_KWH_log, aes_string(x = "KWH_pp_pc", y = "Happiness")) +
    geom_point(color = "blue") +
    geom_smooth(method = lm, color = "salmon1", fill = "lightblue", se = TRUE) +
    labs(x = "Logarithme de la consommmation énergétique", y = "Happiness") +
    theme_minimal()


data_migration <- data
data_migration$Net_Migration <- log(data_migration$Net_Migration)
migrationplot <- ggplot(data_migration, aes_string(x = "Net_Migration", y = "Happiness")) +
    geom_point() +
    geom_smooth(method = lm, color = "salmon1", fill = "lightblue", se = TRUE) +
    labs(x = "Logarithme de la migration", y = "Happiness") +
    theme_minimal()

logplots <- list(PIBplot, KWHplot, migrationplot)
```

::: {#fig9 .fig}
```{r echo=FALSE, fig.height=6, fig.width=8}

do.call(grid.arrange, c(scatter_plots[c(2,7)],logplots[c(1,2)], ncol = 2))
```

Figure 10 : Nuages de points avec l'indice de bonheur des variables bénéficiant d'une transformation logarithmique et lesdites transformations
:::

Enfin, nous nous intéressons à des transformations de variables dont les graphes initiaux ne donnait pas une belle linéarité avec l'indice de bonheur. Le PIB/hab et la consommation énergétique ont une forte concentration des individus autour des valeurs faibles et quelques individus aux valeurs élevées décrivant originellement une relation plus logarithmique que linéaire.

Appliquer un logarithme au PIB par habitant et à la consommation énergétique permet un lien linéaire très clair avec l'indice de bonheur. Cette réalisation nous indique que nous obtiendrons de meilleurs modèles en utilisant ces transformations logarithmiques plutôt que les variables originelles..

```{r echo=FALSE}
box_plots <- list()
j <- 1

for (i in c(2, 3, 5, 7, 9, 11)) {
    p <- ggplot(data, aes_string(y = data[[i]])) +
        geom_boxplot(
            fill = 'lightblue', notch = FALSE, outlier.colour = "salmon1", outlier.shape = 8,
            outlier.size = 4
        ) +
        labs(x = nomsdevar[i-1]) +
        theme_minimal()
    box_plots[[j]] <- p
    j <- j + 1
}

# nombre de colonnes voulu
ncol_plot <- 3
```

::: {#fig10 .fig}
```{r echo=FALSE, fig.height=6, fig.width=6}
do.call(grid.arrange, c(box_plots, ncol = ncol_plot))
```

Figure 10 : Boxplots des variables explicatives
:::

Un affichage en boîtes à moustache permet de repérer très facilement les **outliers**, ces individus qui étirent fortement la distribution. En effet, sur la figure 10, on peut comparer une distribution classique, celle de la corruption politique, avec des distribution perturbée par des individus extrêmes (PIB, Migration, Densité de population, dépenses militaires ou Taux de scolarisation par exemple).

A nouveau, on remarque une importante concentration des individus pour ce qui est de la migration, la densité de population et les inscriptions à l'école primaire. On visualise bien la concentration des pays les plus pauvres dans la moitié basse de boxplot du PIB par habitant qui nous a poussé à tester une transformation logarithmique.

::: {#fig11 .fig}
```{r echo=FALSE}
ggplot(data, aes(x = OCDE, y = Happiness)) +
    geom_boxplot(fill = "salmon1", alpha = 0.7) +
    labs(title = "Boxplot du bonheur en fonction de l'appartenance à l'OCDE", y = "Score de bonheur") +
    theme_minimal()
```

Figure 11 : Boxplot du bonheur en fonction de l'appartenance à l'OCDE
:::

Il est clair que les pays membres de l'OCDE ont un bonheur bien plus élevé que les non-membres. On s'attend donc à observer une certaine significativité de l'OCDE dans notre modèle.

# **Analyse et discussion des résultats**

## Modélisation principale

Nous allons commencer par comparer deux modèles. Le premier, que l'on appellera **reglin**, correspond à la régression linéaire complète, sans transformation de variable, et le deuxième **reglog**, à une régression avec une transformation par logarithme sur les variables de la figure 9.

```{r echo=FALSE}
# premier modèle : toutes les variables candidates
reglin <- lm(Happiness ~ Political_Corruption + KWH_pp_pc + GDP_per_Capita + Lifespan + Net_Migration + Overweight_Adults + Population_Density + Military_Expenses + Population_Growth + OCDE + Primary_School_Enrollment, data = data)

reglog <- lm(Happiness ~ Political_Corruption + log(KWH_pp_pc) + log(GDP_per_Capita) + Lifespan + Net_Migration + Overweight_Adults + Population_Density + Military_Expenses + Population_Growth + OCDE + Primary_School_Enrollment, data = data)

cat("\n--- Résumé du modèle (reg1) ---\n")
stargazer(reglin, reglog, type = "text", digits = 2)
```

Nos deux modèles expliquent plus de 80% de la variance de l'indice de bonheur. Cependant, le modèle avec transformation logarithmique (reglog) a un R² ajusté légèrement supérieur, ce qui indique une meilleure capacité explicative. Nos variables significatives, par ordre de significativité, sont l'espérance de vie, le surpoids, le PIB par habitant, la dépense militaire, la participation à l'OCDE et l'inscription à l'école primaire.

Présentation et interprétation des résultats obtenus : utiliser un tableau récapitulatif des modèles principaux testés

## Modélisation avancée et sélection de variables

Nous partons du modèle logarithmique `reglog` qui semblait le plus performant (meilleur R² ajusté et meilleure linéarité).

### Traitement de la multicolinéarité

Examinons les facteurs d'inflation de la variance (VIF) pour détecter la multicolinéarité.

```{r echo=FALSE}
# Calcul du VIF initial
vif_values <- vif(reglog)
vif_df <- data.frame(Variable = names(vif_values), VIF = as.numeric(vif_values))
stargazer(vif_df, type = "text", summary = FALSE, rownames = FALSE, title = "VIF du modèle complet (reglog)", digits = 2)
```

**Analyse de la multicolinéarité :** Les résultats indiquent une multicolinéarité sévère pour le PIB par habitant (**16.82**) et la consommation d'énergie (**13.01**), ainsi qu'une valeur limite pour l'espérance de vie (**5.24**). Bien que le PIB présente le VIF le plus élevé, il constitue la variable économique de référence. La consommation d'énergie (`KWH_pp_pc`) étant une proxy de l'industrialisation très corrélée au PIB, sa suppression est la correction logique pour réduire la redondance sans perdre l'information sur la richesse. Nous retirons donc `KWH_pp_pc`.

```{r echo=FALSE}
# Modèle corrigé : suppression de KWH_pp_pc
reg_vif_clean <- lm(Happiness ~ Political_Corruption + log(GDP_per_Capita) + Lifespan + Net_Migration + Overweight_Adults + Population_Density + Military_Expenses + Population_Growth + OCDE + Primary_School_Enrollment, data = data)

# Nouveau VIF de contrôle
vif_values_clean <- vif(reg_vif_clean)
vif_df_clean <- data.frame(Variable = names(vif_values_clean), VIF = as.numeric(vif_values_clean))
stargazer(vif_df_clean, type = "text", summary = FALSE, rownames = FALSE, title = "VIF après suppression de la consommation d'énergie", digits = 2)
```

L'espérance de vie conserve un VIF problématique (\>5) après cette suppression, elle pourrait également être écartée par la sélection automatique ci-après, mais nous choisissons de la conserver pour l'instant car elle représente la dimension "Santé" distincte de la "Richesse".

### Sélection de variables (Stepwise par AIC)

Nous utilisons une procédure de sélection pas à pas descendante (backward) basée sur le critère d'information d'Akaike (AIC) pour ne garder que les variables pertinentes.

```{r echo=FALSE}
# Sélection backward
reg_final_step <- step(reg_vif_clean, direction = "backward", trace = 0)

cat("\n--- Résumé du modèle optimisé par AIC ---\n")
stargazer(reg_final_step, type = "text", title = "Résumé du modèle optimisé par AIC", digits = 3, single.row = TRUE)
```

Ce modèle ne contient plus que les variables qui apportent une information significative au sens de l'AIC. C'est notre nouveau modèle de référence. On constate l'absence de variables non significatives : la dépense militaire et la densité de population.

### Test de non-linéarités et d'interactions

Il est fréquent en économie du bonheur d'observer des rendements décroissants (déjà capturé par le log du PIB). Nous pouvons aussi tester si l'effet de la richesse dépend du niveau de développement (interaction OCDE \* PIB).

Testons un modèle avec interaction :

```{r echo=FALSE}
# Ajout de l'interaction OCDE * log(GDP)
reg_interact <- update(reg_final_step, . ~ . + OCDE:log(GDP_per_Capita))

# Comparaison des modèles
stargazer(reg_final_step, reg_interact, type = "text", title = "Comparaison avec interaction", digits = 3)

# Test anova pour voir si l'interaction apporte significativement de l'information
anova(reg_final_step, reg_interact)
```

**Analyse de l'interaction :** Le test ANOVA compare le modèle avec et sans l'interaction `OCDE * GDP`. La p-value obtenue (**0.1474**) est supérieure au seuil standard de 0.05. Nous ne pouvons donc pas rejeter l'hypothèse nulle. Cela signifie que l'ajout du terme d'interaction n'améliore pas significativement la qualité du modèle. L'hypothèse selon laquelle l'importance du PIB sur le bonheur différerait significativement entre les pays de l'OCDE et les autres n'est pas validée statistiquement par nos données.

### Choix du modèle final

Compte tenu des résultats précédents, nous retenons le modèle issu de la sélection Stepwise (**reg_final_step**) sans le terme d'interaction.

```{r echo=FALSE}
# Définition définitive du modèle final
best_model <- reg_final_step
```

## Diagnostics des résidus sur le modèle final

Vérifions maintenant la validité des hypothèses des MCO sur notre modèle final : `best_model`.

```{r echo=FALSE}
# 1. Homoscédasticité (Breusch-Pagan)
bp_test <- bptest(best_model)

# 2. Normalité des résidus (Shapiro-Wilk)
shapiro_test <- shapiro.test(resid(best_model))

# 3. Autocorrélation (Durbin-Watson)
dw_test <- dwtest(best_model)

# Création d'un tableau récapitulatif
diag_df <- data.frame(
    Test = c("Breusch-Pagan (Homoscédasticité)", "Shapiro-Wilk (Normalité)", "Durbin-Watson (Indépendance)"),
    Statistique = c(round(bp_test$statistic, 3), round(shapiro_test$statistic, 3), round(dw_test$statistic, 3)),
    P_Value = c(format(bp_test$p.value, digits = 4), format(shapiro_test$p.value, digits = 4), format(dw_test$p.value, digits = 4))
)

stargazer(diag_df, type = "text", summary = FALSE, rownames = FALSE, title = "Tableau de synthèse des diagnostics", digits = 4)
```

**Interprétation des diagnostics :** Les tests sont concluants et valident toutes les hypothèses des Moindres Carrés Ordinaires :

-   **Homoscédasticité validée :** Le test de Breusch-Pagan (p-value = **0.7434**) ne rejette pas l'hypothèse nulle. La variance des résidus est constante.

-   **Normalité validée :** Le test de Shapiro-Wilk (p-value = **0.3435**) confirme que les résidus suivent une loi normale. L'inférence statistique (t-tests, intervalles de confiance) est donc fiable.

-   **Indépendance validée :** Le test de Durbin-Watson (p-value = **0.2697**, DW $\approx$ 1.88) ne détecte pas d'autocorrélation significative.

### Visualisation des diagnostics

::: {#fig12 .fig}
```{r echo=FALSE, fig.height=4, fig.width=8}
par(mfrow = c(1, 2))
plot(best_model, which = 1, main = "Résidus vs Ajustés") # Homoscédasticité
plot(best_model, which = 2, main = "Q-Q Plot") # Normalité
par(mfrow = c(1, 1))
```

Figure 12 : Diagnostics visuels des résidus
:::

**Analyse visuelle :** Les graphiques confirment la robustesse du modèle.

-   **Résidus vs Ajustés :** Le nuage de points est dispersé aléatoirement autour de 0 sans forme d'entonnoir marquée, ce qui corrobore l'homoscédasticité.

-   **Q-Q Plot :** Les points s'alignent correctement sur la droite de normalité. On note quelques légers écarts aux extrémités correspondant à des pays comme **Oman** (résidu positif élevé) ou l'**Afghanistan** et le **Botswana** (résidus négatifs), mais ces *outliers* restent ponctuels et ne violent pas l'hypothèse de normalité globale.

### Conclusion sur les corrections

Les diagnostics étant excellents, aucune correction (type White / HC1) n'est nécessaire. Nous pouvons interpréter directement les coefficients du modèle final.

### Analyse des points influents

Nous complétons les diagnostics par une analyse des points influents (points leviers et outliers) qui pourraient biaiser l'estimation.

::: {#fig13 .fig}
```{r echo=FALSE, fig.height=4, fig.width=8}
par(mfrow = c(1, 2))
plot(best_model, which = 4, main = "Distance de Cook")
plot(best_model, which = 5, main = "Résidus vs Levier")
par(mfrow = c(1, 1))
```

Figure 13 : Détection des points influents (Distance de Cook et Effet Levier)
:::

**Analyse des points influents :** L'analyse de la distance de Cook met en évidence trois pays : **Oman**, la **Somalie** et la **Jordanie**.

-   **Distance de Cook :** Bien que ces pays dépassent le seuil théorique de sensibilité ($4/n \approx 0.03$), aucune observation ne s'approche du seuil critique de 0.5 ou 1. Ils influencent le modèle sans le déstabiliser.

-   **Levier vs Résidus :** La **Somalie** se distingue par un fort effet de levier (probablement dû à ses valeurs extrêmes en scolarisation, ou des valeurs manquantes trop lissées par notre pré traitement), mais son résidu reste modéré. **Oman** et la **Jordanie** ont des résidus plus importants, suggérant que le modèle explique moins bien leur niveau de bonheur spécifique (facteurs géopolitiques ou culturels non capturés).

En conclusion, bien que ces pays atypiques existent, ils ne remettent pas en cause la validité globale du modèle.

```{r echo=FALSE}
# Affichage final du modèle
stargazer(best_model, type = "text", title = "Résultats finaux du modèle économétrique", digits = 3)
```

## Conclusion et discussion

Notre analyse visait à déterminer les déterminants du bonheur ("Happiness") à travers une régression linéaire multivariée sur un échantillon de 125 pays.

**Résultats principaux :**

1.  **Richesse et Santé :** Le PIB par habitant (en log) et l'espérance de vie sont les déterminants les plus puissants et positifs du bonheur. La relation logarithmique confirme que l'utilité marginale du revenu est décroissante : gagner 1000\$ de plus apporte plus de bonheur dans un pays pauvre que dans un pays riche.
2.  **Facteurs institutionnels :** La corruption politique a un impact négatif significatif, tandis que l'appartenance à l'OCDE est souvent associée à un niveau de bonheur supérieur, toutes choses égales par ailleurs.
3.  **Interaction non significative :** Nos tests n'ont pas permis de valider statistiquement que l'effet de la richesse diffère significativement selon le niveau de développement (appartenance à l'OCDE). Le modèle simple reste le plus performant.
4.  **Robustesse et Points influents :** Les diagnostics (homoscédasticité, normalité) sont satisfaisants. L'analyse des points influents a identifié la Somalie (fort levier) et Oman (résidu élevé) comme des cas particuliers, mais leur impact reste limité et ne biaise pas les conclusions générales.
5.  **Limites du modèle :** Bien que les diagnostics soient globalement satisfaisants, des limites inhérentes aux données transversales subsistent.

**Limites et Perspectives :**

-   **Causalité :** La corrélation n'implique pas la causalité. Est-ce que les gens heureux sont plus productifs (augmentant le PIB) ou l'inverse ?

-   **Variables omises :** La culture, le climat, ou la liberté politique (différente de la corruption) pourraient jouer un rôle important.

-   **Données manquantes :** L'exclusion de certains pays (Somalie, etc.) pour manque de données peut biaiser les résultats (biais de sélection).

-   **Perspectives :** Pour aller plus loin, une analyse en panel (longitudinale) permettrait de contrôler les effets fixes par pays (culture, géographie) et de mieux saisir la dynamique temporelle du bonheur. L'ajout d'indicateurs d'inégalité (Gini) serait également pertinent.

# Bibliographie

1.  **Easterlin, R. A.** (1974). "Does Economic Growth Improve the Human Lot? Some Empirical Evidence". *Nations and Households in Economic Growth*.
2.  **Gallup World Poll**. Methodology for the World Happiness Report.
3.  **Kanto Fiaferana**, [Cours de régression linéaire](https://pyrrhamide.github.io/regressions/reg-lin.html)
4.  **Quarto**, [Quarto](https://quarto.org/)
5.  Ludovic C. & mathandy, [StackExchange](https://tex.stackexchange.com/questions/145657/align-equation-left)
6.  **Esteban Ortiz-Ospina, Max Roser** (2013, last update: 2024). [Happiness and life satisfaction](https://ourworldindata.org/happiness-and-life-satisfaction)

**Sources des données :** - World Happiness Report (Happiness Score) - World Bank (GDP, Lifespan, Corruption, etc.) - Our World in Data (Energy, Military, Population)

**Utilisation d'outils d'intelligence artificielle :** - GPT-mini-o5 - Gemini 3 Pro
